{"ast":null,"code":"export const REQUEST_TOKEN = 'REQUEST_TOKEN';\nexport const RECEIVE_USER_DATA = 'RECEIVE_USER_DATA';\nexport const ACCESS_TOKEN_WAS_NOT_VALID = 'ACCESS_TOKEN_WAS_NOT_VALID';\nexport const REFRESH_TOKEN_WAS_NOT_VALID = 'REFRESH_TOKEN_WAS_NOT_VALID';\nexport const REFRESHING_TOKENS = 'REFRESHING_TOKENS';\nexport function requestToken() {\n  return {\n    type: REQUEST_TOKEN\n  };\n}\nexport function receiveUserData(userData) {\n  return {\n    type: RECEIVE_USER_DATA,\n    userData: userData\n  };\n}\nexport function accessTokenWasNotValid() {\n  return {\n    type: ACCESS_TOKEN_WAS_NOT_VALID\n  };\n}\nexport function refreshTokenWasNotValid() {\n  return {\n    type: REFRESH_TOKEN_WAS_NOT_VALID\n  };\n}\nexport function refreshingTokens(accessToken, refreshToken) {\n  return {\n    type: REFRESHING_TOKENS,\n    accessToken,\n    refreshToken\n  };\n}\nexport function refreshTokensAction(path, refreshToken) {\n  return async dispatch => {\n    const json = await refreshTokens(path, refreshToken);\n\n    if (json.statusCode === 401) {\n      dispatch(refreshTokenWasNotValid());\n    }\n\n    return json;\n  };\n}\n\nasync function refreshTokens(path, refreshToken) {\n  const resp = await fetch(path, {\n    method: 'POST',\n    headers: {\n      'Authorization': 'Bearer ' + refreshToken\n    }\n  });\n  const json = await resp.json();\n  return await json;\n}\n\nexport function logInWithToken(path, token, refreshPath, refreshToken) {\n  return async function (dispatch) {\n    dispatch(requestToken());\n\n    async function tryLog() {\n      const resp = await fetch(path, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': 'Bearer ' + token\n        }\n      });\n      return await resp.json();\n    }\n\n    const json = await tryLog();\n    console.log(json);\n\n    if (json.statusCode === 401 && refreshToken && refreshPath) {\n      dispatch(accessTokenWasNotValid());\n      const refreshJson = await refreshTokens(refreshPath, refreshToken);\n      console.log(refreshJson);\n\n      if (refreshJson.statusCode === 401) {\n        dispatch(refreshTokenWasNotValid());\n      } else if (refreshJson.statusCode === 201) {\n        dispatch(refreshingTokens(json.body, access_token, json.body.refre));\n      }\n    } else dispatch(receiveUserData(json));\n\n    return await json;\n  };\n}","map":{"version":3,"sources":["C:/Users/Bogdan/Desktop/Task 3 React/my-app — копия/src/actions/tokenManagement.js"],"names":["REQUEST_TOKEN","RECEIVE_USER_DATA","ACCESS_TOKEN_WAS_NOT_VALID","REFRESH_TOKEN_WAS_NOT_VALID","REFRESHING_TOKENS","requestToken","type","receiveUserData","userData","accessTokenWasNotValid","refreshTokenWasNotValid","refreshingTokens","accessToken","refreshToken","refreshTokensAction","path","dispatch","json","refreshTokens","statusCode","resp","fetch","method","headers","logInWithToken","token","refreshPath","tryLog","console","log","refreshJson","body","access_token","refre"],"mappings":"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","sourcesContent":["export const REQUEST_TOKEN = 'REQUEST_TOKEN';\r\nexport const RECEIVE_USER_DATA = 'RECEIVE_USER_DATA';\r\nexport const ACCESS_TOKEN_WAS_NOT_VALID = 'ACCESS_TOKEN_WAS_NOT_VALID';\r\nexport const REFRESH_TOKEN_WAS_NOT_VALID = 'REFRESH_TOKEN_WAS_NOT_VALID';\r\nexport const REFRESHING_TOKENS = 'REFRESHING_TOKENS';\r\n\r\nexport function requestToken() {\r\n    return {\r\n        type: REQUEST_TOKEN\r\n    }\r\n}\r\nexport function receiveUserData(userData) {\r\n    return {\r\n        type: RECEIVE_USER_DATA,\r\n        userData: userData\r\n    }\r\n}\r\nexport function accessTokenWasNotValid() {\r\n    return {\r\n        type: ACCESS_TOKEN_WAS_NOT_VALID\r\n    }\r\n}\r\nexport function refreshTokenWasNotValid() {\r\n    return {\r\n        type: REFRESH_TOKEN_WAS_NOT_VALID\r\n    }\r\n}\r\nexport function refreshingTokens(accessToken,refreshToken) {\r\n    return{\r\n        type: REFRESHING_TOKENS,\r\n        accessToken,\r\n        refreshToken\r\n    }\r\n}\r\nexport function refreshTokensAction(path, refreshToken) {\r\n    return async (dispatch) => {\r\n        const json = await refreshTokens(path, refreshToken);\r\n        if (json.statusCode === 401) {\r\n            dispatch(refreshTokenWasNotValid());\r\n        }\r\n        return json;\r\n    }\r\n}\r\nasync function refreshTokens(path, refreshToken) {\r\n    const resp = await fetch(\r\n        path,\r\n        {\r\n            method: 'POST',\r\n            headers: {\r\n                'Authorization': 'Bearer ' + refreshToken\r\n            }\r\n        }\r\n    );\r\n    const json = await resp.json();\r\n    return await json;\r\n}\r\nexport function logInWithToken(path, token, refreshPath, refreshToken) {\r\n    return async function (dispatch) {\r\n        dispatch(requestToken());\r\n        async function tryLog() {\r\n            const resp = await fetch(\r\n                path,\r\n                {\r\n                    method: 'GET',\r\n                    headers: {\r\n                        'Content-Type': 'application/json',\r\n                        'Authorization': 'Bearer ' + token\r\n                    }\r\n                }\r\n            );\r\n            return await resp.json();\r\n        }\r\n        const json = await tryLog();\r\n        console.log(json);\r\n        if (json.statusCode === 401 && refreshToken && refreshPath) {\r\n            dispatch(accessTokenWasNotValid());\r\n            const refreshJson = await refreshTokens(refreshPath, refreshToken);\r\n            console.log(refreshJson);\r\n            if (refreshJson.statusCode === 401) {\r\n                dispatch(refreshTokenWasNotValid());\r\n            }else if (refreshJson.statusCode === 201) {\r\n                dispatch(refreshingTokens(json.body,access_token,json.body.refre))\r\n            }\r\n        } else\r\n            dispatch(receiveUserData(json));\r\n        return await json;\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}